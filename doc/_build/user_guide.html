

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User Guide &mdash; ad Python package 1.1.1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="ad Python package 1.1.1 documentation" href="index.html" />
    <link rel="prev" title="Welcome to the ad package" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="_static/logo.png" border="0" alt="ad"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to the ad package"
             accesskey="P">previous</a> |</li>
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a></li>
</ul>

 
      </ul>
    </div>



<div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table of contents</h3>
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a></li>
</ul>

            <h3>Section contents</h3>
            <ul>
<li><a class="reference internal" href="#">User Guide</a><ul>
<li><a class="reference internal" href="#basic-setup">Basic setup</a></li>
<li><a class="reference internal" href="#creating-automatical-differentiation-numbers">Creating automatical differentiation numbers</a></li>
<li><a class="reference internal" href="#basic-math">Basic math</a></li>
<li><a class="reference internal" href="#mathematical-operations">Mathematical operations</a></li>
<li><a class="reference internal" href="#arrays-of-numbers">Arrays of numbers</a></li>
<li><a class="reference internal" href="#access-to-the-derivatives-and-to-the-nominal-value">Access to the derivatives and to the nominal value</a></li>
<li><a class="reference internal" href="#access-to-more-than-one-derivative">Access to more than one derivative</a></li>
<li><a class="reference internal" href="#comparison-operators">Comparison operators</a></li>
<li><a class="reference internal" href="#making-custom-functions-accept-numbers-that-track-derivatives">Making custom functions accept numbers that track derivatives</a></li>
<li><a class="reference internal" href="#miscellaneous-utilities">Miscellaneous utilities</a></li>
<li><a class="reference internal" href="#testing-if-a-variable-can-track-derivatives">Testing if a variable can track derivatives</a></li>
<li><a class="reference internal" href="#python-classes-for-variables-and-functions-with-derivatives">Python classes for variables and functions with derivatives</a></li>
</ul>
</li>
</ul>

          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Search the documentation.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
          <h3>Documentation license</h3>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="user-guide">
<span id="index-0"></span><span id="id1"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basic-setup">
<h2>Basic setup<a class="headerlink" href="#basic-setup" title="Permalink to this headline">¶</a></h2>
<p>Basic mathematical operations involving numbers that track derivatives
only require a simple import:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ad</span> <span class="kn">import</span> <span class="n">adnumber</span>
</pre></div>
</div>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">adnumber()</span></tt> function creates numbers with derivative tracing
capabilities. Existing calculation code can usually run with no or
little modification and automatically produce derivatives.</p>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">ad</span></tt> module contains other features, which can be
made accessible through</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ad</span>
</pre></div>
</div>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">ad</span></tt> package also contains sub-modules for
<a class="reference internal" href="#advanced-math-operations"><em>advanced mathematical functions</em></a></p>
</div>
<div class="section" id="creating-automatical-differentiation-numbers">
<span id="index-1"></span><h2>Creating automatical differentiation numbers<a class="headerlink" href="#creating-automatical-differentiation-numbers" title="Permalink to this headline">¶</a></h2>
<p>Numbers that track their derivatives are input just as you would for
any normal numeric type. In that sense, they are basically <em>wrapped</em>
without really changing their fundamental type. For example, x = 2
can be expressed in any of the basic numeric ways, including:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># acts like an &quot;int&quot; object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c"># acts like a &quot;float&quot; object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">0j</span><span class="p">)</span>  <span class="c"># acts like a &quot;complex&quot; object</span>
</pre></div>
</div>
<p>Mathematical calculations that follow, like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">/</span><span class="mi">3</span>  <span class="c"># if x = adnumber(2), the result is ad(0) because of integer math</span>
</pre></div>
</div>
<p>are interpreted based upon the base numeric types involved.</p>
</div>
<div class="section" id="basic-math">
<h2>Basic math<a class="headerlink" href="#basic-math" title="Permalink to this headline">¶</a></h2>
<p>Calculations can be performed directly, as with regular real or complex
numbers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">square</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span>
<span class="go">ad(4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4j</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">a</span>
<span class="go">ad((3+4j))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">ad(5.0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1j</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">*</span><span class="n">b</span>
<span class="go">ad((7+1j))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">imag</span>
<span class="go">(3.0, 4.0)</span>
</pre></div>
</div>
<p>AD objects that represent real values can also be used to create complex ones:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="mi">1j</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">z</span>
<span class="go">ad((2+3.14j))</span>
</pre></div>
</div>
<p>If an AD object is used as input to <tt class="xref py py-func docutils literal"><span class="pre">adnumber()</span></tt>, then a deepcopy is made,
but no tracking relation is created between the input and output objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span>
<span class="go">ad(2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="ow">is</span> <span class="n">x</span>  <span class="c"># are they the same object?</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">==</span> <span class="n">x</span>  <span class="c"># are the nominal values the same?</span>
<span class="go">True</span>
</pre></div>
</div>
<p>More of this is explained below, but we can see that derivatives show the
disconnect between the objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># derivative of z wrt x</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c"># derivative of z wrt itself</span>
<span class="go">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c"># derivative of x wrt z</span>
<span class="go">0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="mathematical-operations">
<span id="advanced-math-operations"></span><span id="index-2"></span><h2>Mathematical operations<a class="headerlink" href="#mathematical-operations" title="Permalink to this headline">¶</a></h2>
<p>Besides being able to apply basic mathematical operations, this package
provides generalizations of <strong>most of the functions from the standard</strong>
<tt class="xref py py-mod docutils literal"><span class="pre">math</span></tt> <strong>and</strong> <tt class="xref py py-mod docutils literal"><span class="pre">cmath</span></tt> <strong>modules</strong>.
These mathematical functions are found in the <tt class="xref py py-mod docutils literal"><span class="pre">ad.admath</span></tt> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ad.admath</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># Imports sin(), etc.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="go">ad(-0.7568024953079282)</span>
</pre></div>
</div>
<p>These functions are designed to support whichever numeric types are normally
compatible with them. For example, the <tt class="xref py py-func docutils literal"><span class="pre">sin()</span></tt> function has a real and
complex counterpart, as do many others. Some functions, like <tt class="xref py py-func docutils literal"><span class="pre">erf()</span></tt> are
only available in the <tt class="xref py py-mod docutils literal"><span class="pre">math</span></tt> module, so an exception is raised if a
complex number is passed to it.</p>
<p>There are also many other functions not normally found in the <tt class="xref py py-mod docutils literal"><span class="pre">math</span></tt>
and <tt class="xref py py-mod docutils literal"><span class="pre">cmath</span></tt> modules that are conveniently available, like <tt class="xref py py-func docutils literal"><span class="pre">csc()</span></tt>
and others.</p>
<p>The list of available mathematical functions can be obtained with the
<tt class="docutils literal"><span class="pre">pydoc</span> <span class="pre">ad.admath</span></tt> command.</p>
</div>
<div class="section" id="arrays-of-numbers">
<span id="simple-array-use"></span><span id="index-3"></span><h2>Arrays of numbers<a class="headerlink" href="#arrays-of-numbers" title="Permalink to this headline">¶</a></h2>
<p>It is possible to put automatic differentiation numbers with in <a class="reference external" href="http://numpy.scipy.org/">NumPy</a>
arrays and matrices, lists, or tuples, and the returned object is of that
respective type (even nested objects work):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">adnumber</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>  <span class="c"># nested list input</span>
<span class="go">[ad(1), [ad(2), ad(3)]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adnumber</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c"># tuple input</span>
<span class="go">(ad(1), ad(2))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arr</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]))</span>  <span class="c"># NumPy array input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">*</span><span class="n">arr</span>
<span class="go">array([[ad(2), ad(4)],</span>
<span class="go">       [ad(6), ad(8)]], dtype=object)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">arr</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">ad(10)</span>
</pre></div>
</div>
<p>Thus, usual operations on NumPy arrays can be performed transparently
even when these arrays contain numbers that track derivatives.</p>
</div>
<div class="section" id="access-to-the-derivatives-and-to-the-nominal-value">
<span id="index-4"></span><h2>Access to the derivatives and to the nominal value<a class="headerlink" href="#access-to-the-derivatives-and-to-the-nominal-value" title="Permalink to this headline">¶</a></h2>
<p>The nominal value and the derivatives can be accessed independently:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span>
<span class="go">ad(4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span><span class="o">.</span><span class="n">x</span>  <span class="c"># the underlying numeric object</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># first derivative wrt x</span>
<span class="go">4.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span><span class="o">.</span><span class="n">d2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># second derivative wrt x</span>
<span class="go">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span><span class="o">.</span><span class="n">d</span><span class="p">()</span>  <span class="c"># left empty returns a dictionary of related derivatives</span>
<span class="go">{ad(4): 4.0}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">square</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c"># if a derivative doesn&#39;t exist, zero is returned</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">square</span><span class="o">/</span><span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">d2c</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>  <span class="c"># second cross-derivative wrt x and y, either order is ok</span>
<span class="go">-1.7777777777777777</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>  <span class="c"># since &quot;square&quot; is a dependent variable, derivative is zero</span>
<span class="go">0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="access-to-more-than-one-derivative">
<h2>Access to more than one derivative<a class="headerlink" href="#access-to-more-than-one-derivative" title="Permalink to this headline">¶</a></h2>
<p>Arrays of derivatives can be obtained through the <tt class="xref py py-func docutils literal"><span class="pre">gradient()</span></tt> and
<tt class="xref py py-func docutils literal"><span class="pre">hessian()</span></tt> methods. The individual variables can be more easily
identified when the variables are <strong>tagged</strong>, though tags <em>do not have
to be distinct</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">)</span>  <span class="c"># Tag</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">3.14</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sum_value</span> <span class="o">=</span> <span class="n">u</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">/</span><span class="n">u</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sum_value</span>
<span class="go">ad(62.9)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sum_value</span><span class="o">.</span><span class="n">d</span><span class="p">()</span>
<span class="go">{ad(0.1, u): -626.9999999999999, ad(3.14, v): 20.0}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sum_value</span><span class="o">.</span><span class="n">gradient</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="go">[-626.9999999999999, 20.0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sum_value</span><span class="o">.</span><span class="n">hessian</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="go">[[12559.999999999998, -199.99999999999997], [-199.99999999999997, 0.0]]</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-operators">
<span id="index-5"></span><h2>Comparison operators<a class="headerlink" href="#comparison-operators" title="Permalink to this headline">¶</a></h2>
<p>Comparison operators behave naturally as they would with numbers outside of
this package, even with other scalar values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">ad(0.2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">ad(1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">x</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="making-custom-functions-accept-numbers-that-track-derivatives">
<span id="index-6"></span><h2>Making custom functions accept numbers that track derivatives<a class="headerlink" href="#making-custom-functions-accept-numbers-that-track-derivatives" title="Permalink to this headline">¶</a></h2>
<p>Due to the nature of automatic differentiation, unless a function can be
represented with a mathematical equation, automatic differentiation is
meaningless. For custom functions that cannot be represented mathematically
(i.e., those that do not have an analytical form), derivatives may be
calculated using other means like finite difference derivatives.</p>
</div>
<div class="section" id="miscellaneous-utilities">
<h2>Miscellaneous utilities<a class="headerlink" href="#miscellaneous-utilities" title="Permalink to this headline">¶</a></h2>
<p id="index-7">It is sometimes useful to use the gradients and hessians provided by this
package for the purpose of supplementing an optimization routine, like
those in the <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">scipy.optimize</a> submodule. With this package, a function
can be conveniently wrapped with functions that return both the gradient
and hessian:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ad</span> <span class="kn">import</span> <span class="n">gh</span>  <span class="c"># the gradient and hessian functions generator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_cool_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">10.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">5.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_cool_gradient</span><span class="p">,</span> <span class="n">my_cool_hessian</span> <span class="o">=</span> <span class="n">gh</span><span class="p">(</span><span class="n">my_cool_function</span><span class="p">)</span>
</pre></div>
</div>
<p>These objects (<tt class="xref py py-func docutils literal"><span class="pre">my_cool_gradient()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">my_cool_hessian()</span></tt>)
<em>are functions</em> that accept an array <tt class="docutils literal"><span class="pre">x</span></tt> and other optional args.
Depending on the optimization routine, you may be able to use only
the gradient function (typically with the keyword <tt class="docutils literal"><span class="pre">jac=...</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bnds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">my_cool_function</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;L-BFGS-B&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">jac</span><span class="o">=</span><span class="n">my_cool_gradient</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;ftol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="s">&#39;disp&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([ 10.,   0.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">25.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">jac</span>
<span class="go">array([  7.10542736e-15,   1.00000000e+01])</span>
</pre></div>
</div>
<p>You might wonder why the final gradient (<tt class="docutils literal"><span class="pre">res.jac</span></tt>) isn&#8217;t precisely [0, 10].
It&#8217;s <em>not</em> because of numerical error in the AD methods, because although it
appears that the final <tt class="docutils literal"><span class="pre">res.x</span></tt> value is precisely [10, 0], if we print out
all the available digits, we see that this is not the case (i.e., <a class="reference external" href="http://numpy.scipy.org/">NumPy</a>
was not being completely truthful about it&#8217;s values with pretty printing):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="go">[10.000000000000004, 0.0]</span>
</pre></div>
</div>
<p>The real reason for the inaccuracy is because of the <tt class="docutils literal"><span class="pre">None</span></tt> upper bounds
given to the <cite>L-BFGS-B</cite> algorithm. If we had used finite upper bounds,
we get the exact answer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bnds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">my_cool_function</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;L-BFGS-B&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">jac</span><span class="o">=</span><span class="n">my_cool_gradient</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;ftol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="s">&#39;disp&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="go">[10.0, 0.0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">jac</span><span class="p">)</span>
<span class="go">[0.0, 10.0]</span>
</pre></div>
</div>
<p>Notice that the use of <tt class="xref py py-func docutils literal"><span class="pre">gh()</span></tt> doesn&#8217;t require you to explicitly
initialize any variable with <tt class="xref py py-func docutils literal"><span class="pre">adnumber()</span></tt> since it all happens
internally with the wrapped functions.</p>
</div>
<div class="section" id="testing-if-a-variable-can-track-derivatives">
<h2>Testing if a variable can track derivatives<a class="headerlink" href="#testing-if-a-variable-can-track-derivatives" title="Permalink to this headline">¶</a></h2>
<p>The recommended way of testing whether <tt class="xref py py-data docutils literal"><span class="pre">value</span></tt> tracks
derivatives handled by this module is by checking whether
<tt class="xref py py-data docutils literal"><span class="pre">value</span></tt> is an instance of <tt class="xref py py-class docutils literal"><span class="pre">ADF</span></tt>, through
<tt class="docutils literal"><span class="pre">isinstance(value,</span> <span class="pre">ad.ADF)</span></tt>.</p>
</div>
<div class="section" id="python-classes-for-variables-and-functions-with-derivatives">
<h2>Python classes for variables and functions with derivatives<a class="headerlink" href="#python-classes-for-variables-and-functions-with-derivatives" title="Permalink to this headline">¶</a></h2>
<p>Numbers with derivatives are represented through two different
classes:</p>
<ol class="arabic simple">
<li>a class for independent variables (<tt class="xref py py-class docutils literal"><span class="pre">ADV</span></tt>, which
inherits from <tt class="xref py py-class docutils literal"><span class="pre">ADF</span></tt>),</li>
<li>a class for functions that depend on independent variables
(<tt class="xref py py-class docutils literal"><span class="pre">ADF</span></tt>).</li>
</ol>
<p>Documentation for these classes is available in their Python
docstring, which can for instance displayed through <a class="reference external" href="http://docs.python.org/library/pydoc.html">pydoc</a>.</p>
<p>The factory function <tt class="xref py py-func docutils literal"><span class="pre">adnumber()</span></tt> creates variables and thus returns
a <tt class="xref py py-class docutils literal"><span class="pre">ADV</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">adnumber</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;class &#39;ad.ADV&#39;&gt;</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">ADV</span></tt> objects can be used as if they were regular Python
numbers (the summation, etc. of these objects is defined).</p>
<p>Mathematical expressions involving numbers with derivatives
generally return <tt class="xref py py-class docutils literal"><span class="pre">ADF</span></tt> objects, because they
represent mathematical functions and not simple variables; these
objects store all the variables they depend on:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">admath</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">&lt;class &#39;ad.ADF&#39;&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="Welcome to the ad package"
             >previous</a> |</li>
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a></li>
</ul>

 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Abraham Lee.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>